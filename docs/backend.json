{
  "entities": {
    "Vehicle": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vehicle",
      "type": "object",
      "description": "Represents a vehicle available for rent.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the vehicle."
        },
        "type": {
          "type": "string",
          "description": "The type of vehicle (e.g., motorcycle, car)."
        },
        "make": {
          "type": "string",
          "description": "The make of the vehicle (e.g., Honda, Toyota)."
        },
        "model": {
          "type": "string",
          "description": "The model of the vehicle (e.g., Civic, CBR500R)."
        },
        "year": {
          "type": "number",
          "description": "The manufacturing year of the vehicle."
        },
        "rentalPrice": {
          "type": "number",
          "description": "The price to rent the vehicle per day."
        },
        "specifications": {
          "type": "string",
          "description": "Details of vehicle specifications"
        },
        "imageURL": {
          "type": "string",
          "description": "URL of the vehicle image"
        }
      },
      "required": [
        "id",
        "type",
        "make",
        "model",
        "year",
        "rentalPrice"
      ]
    },
    "Rental": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Rental",
      "type": "object",
      "description": "Represents a rental booking made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the rental booking."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Rental)"
        },
        "vehicleId": {
          "type": "string",
          "description": "Reference to Vehicle. (Relationship: Vehicle 1:N Rental)"
        },
        "startDate": {
          "type": "string",
          "description": "The start date and time of the rental.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "The end date and time of the rental.",
          "format": "date-time"
        },
        "totalCost": {
          "type": "number",
          "description": "The total cost of the rental."
        },
        "status": {
          "type": "string",
          "description": "The status of the rental (e.g., pending, confirmed, completed, cancelled)."
        }
      },
      "required": [
        "id",
        "userId",
        "vehicleId",
        "startDate",
        "endDate",
        "totalCost",
        "status"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "The user's phone number."
        },
        "profilePictureURL": {
          "type": "string",
          "description": "URL of the user profile picture"
        },
        "authProvider": {
          "type": "string",
          "description": "Authentication provider used to login (e.g., email, google, facebook)."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "phoneNumber"
      ]
    },
    "GPSData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GPSData",
      "type": "object",
      "description": "Represents GPS coordinates of a vehicle at a specific time.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the GPS data entry."
        },
        "vehicleId": {
          "type": "string",
          "description": "Reference to Vehicle. (Relationship: Vehicle 1:N GPSData)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp when the GPS data was recorded.",
          "format": "date-time"
        },
        "latitude": {
          "type": "number",
          "description": "Latitude coordinate of the vehicle."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude coordinate of the vehicle."
        }
      },
      "required": [
        "id",
        "vehicleId",
        "timestamp",
        "latitude",
        "longitude"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership is enforced via the `userId` parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/rentals/{rentalId}",
        "definition": {
          "entityName": "Rental",
          "schema": {
            "$ref": "#/backend/entities/Rental"
          },
          "description": "Stores rental bookings for a specific user.  Path-based ownership inherited from the parent user document. Includes denormalized 'userId' and 'vehicleId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user who created the rental."
            },
            {
              "name": "rentalId",
              "description": "The unique ID of the rental booking."
            }
          ]
        }
      },
      {
        "path": "/vehicles/{vehicleId}",
        "definition": {
          "entityName": "Vehicle",
          "schema": {
            "$ref": "#/backend/entities/Vehicle"
          },
          "description": "Stores vehicle data. Vehicle data is publicly accessible for browsing and the application assumes that specific vehicle permissions (like modifying vehicle details) are managed through backend logic or admin roles (not defined in this structure).",
          "params": [
            {
              "name": "vehicleId",
              "description": "The unique ID of the vehicle."
            }
          ]
        }
      },
      {
        "path": "/vehicles/{vehicleId}/gps_data/{gpsDataId}",
        "definition": {
          "entityName": "GPSData",
          "schema": {
            "$ref": "#/backend/entities/GPSData"
          },
          "description": "Stores GPS data for a specific vehicle. Access to this subcollection is assumed to be controlled through backend logic. Includes denormalized 'vehicleId'.",
          "params": [
            {
              "name": "vehicleId",
              "description": "The unique ID of the vehicle associated with the GPS data."
            },
            {
              "name": "gpsDataId",
              "description": "The unique ID of the GPS data entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Rideasy application, focusing on vehicle rentals and real-time tracking. The design prioritizes Authorization Independence, QAPs, and clarity, following the core design principles outlined.\n\n**Authorization Independence:**\n\n*   User data is stored under `/users/{userId}`, ensuring path-based ownership. Rentals, associated with a user, are stored under `/users/{userId}/rentals/{rentalId}`, inheriting the user's ownership implicitly through the path. This avoids the need for `get()` calls to verify ownership.\n*   Vehicle data is globally accessible for browsing. However, the `GPSData` is stored as a subcollection of vehicles (`/vehicles/{vehicleId}/gps_data/{gpsDataId}`), which requires no user-based authorization. The application assumes all GPS data needs to be secured by other means like backend services.\n\n**QAPs (Rules are not Filters):**\n\n*   Segregation is used to differentiate user-owned data (rentals) from globally accessible data (vehicles). User rentals are stored in user-specific subcollections, allowing secure listing based on the user's ID. Vehicles are stored in a top-level collection, assuming different (potentially less restrictive) listing requirements or backend-controlled access.\n\n**Data Clarity and Predictability:**\n\n*   Explicit state modeling is employed for rentals using the `status` field (`pending`, `confirmed`, `completed`, `cancelled`).\n\n**Denormalization:**\n\n*   For the Rental entity, the `userId` and `vehicleId` are denormalized directly into the document. This is necessary to establish the relationship without needing complex lookups during security rule evaluation."
  }
}